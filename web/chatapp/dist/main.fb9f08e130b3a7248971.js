(()=>{"use strict";var e=function e(){var t,n,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a=void 0,(n="usuaris")in(t=this)?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,this.usuaris=[{id_usuari:0,username:"armand",password:"maletin",id_role:0},{id_usuari:1,username:"pep",password:"maletin",id_role:1},{id_usuari:2,username:"jordi",password:"maletin",id_role:3},{id_usuari:3,username:"alicia",password:"maletin",id_role:2},{id_usuari:4,username:"cristina",password:"maletin",id_role:0}]};var t=function e(t,n,a,r,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.author_id=n,this.message=a,this.created=r,this.pubpriv=i,this.dest_id=o};function n(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.messageList=[],this.cargarLocalStorage()}var t,a,r;return t=e,(a=[{key:"addMessage",value:function(e){this.messageList.push(e),this.guardarLocalStorage()}},{key:"autoIncrementId",value:function(){return this.messageList.length>0?this.messageList.at(-1).id:0}},{key:"guardarLocalStorage",value:function(){localStorage.setItem("messages",JSON.stringify(this.messageList))}},{key:"cargarLocalStorage",value:function(){this.messageList=localStorage.getItem("messages")?JSON.parse(localStorage.getItem("messages")):[]}},{key:"deleteMessage",value:function(e){this.messageList.splice(e.id,1),this.guardarLocalStorage()}}])&&n(t.prototype,a),r&&n(t,r),e}();function r(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.grupsList=[],this.cargarLocalStorage()}var t,n,a;return t=e,(n=[{key:"addGroup",value:function(e){this.grupsList.push(e),this.guardarLocalStorage()}},{key:"autoIncrementId",value:function(){return this.grupsList.length>0?this.grupsList.at(-1).id:0}},{key:"guardarLocalStorage",value:function(){localStorage.setItem("groups",JSON.stringify(this.grupsList))}},{key:"cargarLocalStorage",value:function(){this.grupsList=localStorage.getItem("groups")?JSON.parse(localStorage.getItem("groups")):[]}}])&&r(t.prototype,n),a&&r(t,a),e}();var o=function e(t,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.name=n,this.parent_id=a},s=document.getElementById("tfNom");function u(e){e.preventDefault();var t=s.value(),n=new i,a=new o(1,t,1);n.addGroup(a)}function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}document.getElementById("btCrear").addEventListener("click",(function(e){u(e)}));var d=document.getElementById("btFormCrearMensaje"),m=document.getElementById("btFormCrearGrupo"),f=document.getElementById("btFormMostrarMensajes"),g=document.getElementById("crearMensajes"),p=document.getElementById("crearGrupos"),y=document.getElementById("mostrarMensajes"),v=document.getElementById("cbPublic"),h=document.getElementById("tfGrupo"),E=document.getElementById("cbPrivado"),b=document.getElementById("tfUsuario"),I=document.getElementById("taMensaje"),w=document.getElementById("btEnviar"),L=document.getElementById("containerPublic"),k=document.getElementById("containerPrivate");document.getElementById("tfNombreGrupo"),document.getElementById("btCrearGrupo");d.addEventListener("click",(function(n){!function(n){function r(){v.checked?k.style.display="none":k.style.display="block",E.checked?L.style.display="none":L.style.display="block"}function o(){var e=new Date,t=e.getDate(),n=e.getMonth()+1,a=e.getFullYear();return t<10&&(t="0"+t),n<10&&(n="0"+n),e=n+"/"+t+"/"+a}function s(n){var r;n.preventDefault();var s=I.value,u=new e;if(v.checked){var c=h.value;r=v.value;var d,m=new i,f=l(m.grupsList);try{for(f.s();!(d=f.n()).done;){var g=d.value;if(g.name==c){var p=new t(m.autoIncrementId()+1,u.usuaris[0].id_usuari,s,o(),r,g.id);(new a).addMessage(p),alert("Missatge enviat!!")}else alert("El grupo introducido no es correcto")}}catch(e){f.e(e)}finally{f.f()}}if(E.checked){var y=b.value;r=E.value;var w,L=l(u.usuaris);try{for(L.s();!(w=L.n()).done;){var k=w.value;if(k.username==y){var S=new a,C=new t(S.autoIncrementId()+1,u.usuaris[0].id_usuari,s,o(),r,k.id_usuari);S.addMessage(C),alert("Missatge enviat!!")}else alert("El usuario introducido no existe")}}catch(e){L.e(e)}finally{L.f()}}}n.preventDefault(),p.style.display="none",y.style.display="none",g.style.display="block",E.addEventListener("change",(function(){r()})),v.addEventListener("change",(function(){r()})),w.addEventListener("click",(function(e){s(e)}))}()})),m.addEventListener("click",(function(e){!function(e){e.preventDefault(),g.style.display="none",y.style.display="none",p.style.display="block",u()}()})),f.addEventListener("click",(function(e){!function(e){e.preventDefault(),g.style.display="none",p.style.display="none",y.style.display="block",function(){var e=document.getElementById("mostrarMensajes"),t=document.createElement("form");t.id="formMostrarMensajes",e.appendChild(t);var n=document.createElement("div");n.name="containerMensajes",t.appendChild(n);var r=document.createElement("table");n.appendChild(r);for(var i=new a,o=0;o<i.length;o++){var s=document.createElement("tr"),u=document.createElement("td");u.innerText=o.id;var l=document.createElement("td");l.innerText=o.message;var c=document.createElement("td");c.innerText=o.created;var d=document.createElement("td");d.innerText=o.pubpriv;var m=document.createElement("td"),f=document.createElement("a");f.href="",f.id="datosMensaje"+o.id,f.innerText="X",m.appendChild(f),s.appendChild(u),s.appendChild(l),s.appendChild(c),s.appendChild(d),s.appendChild(m),r.appendChild(s),f.addEventListener("click",(function(e){e.preventDefault(),console.log(e.target.id),e.target.parentNode.parentNode.remove(),i.deleteMessage(o)}))}}()}()}))})();